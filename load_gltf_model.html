<!DOCTYPE html>
<html>
  <head>
    <title>Three.js â€“ Load glTF (Fixed)</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background-color: #333;
      }
    </style>
  </head>
  <body>
    <script type="module">
      // Import Three.js dan GLTFLoader dari CDN (versi r128 sesuai request)
      import * as THREE from "https://cdn.skypack.dev/three@0.128.0";
      import { GLTFLoader } from "https://cdn.skypack.dev/three@0.128.0/examples/jsm/loaders/GLTFLoader.js";

      // 1. Setup Scene
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0xeeeeee);

      // 2. Setup Camera
      const camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      camera.position.set(0, 1, 3);

      // 3. Setup Renderer
      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.outputEncoding = THREE.sRGBEncoding;
      renderer.shadowMap.enabled = true;
      document.body.appendChild(renderer.domElement);

      // 4. Pencahayaan
      const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
      scene.add(hemiLight);

      const dirLight = new THREE.DirectionalLight(0xffffff, 1);
      dirLight.position.set(5, 10, 7.5);
      dirLight.castShadow = true;
      scene.add(dirLight);

      // 5. Load Model
      let model; // Variabel global disiapkan di sini
      const loader = new GLTFLoader();
      const modelPath = "models/desktop_computer/scene.gltf";

      loader
        .loadAsync(modelPath)
        .then((gltf) => {
          // PERBAIKAN 1: Hapus 'const' agar mengisi variabel global 'model'
          model = gltf.scene;

          // Reset posisi ke tengah
          const box = new THREE.Box3().setFromObject(model);
          const center = box.getCenter(new THREE.Vector3());
          model.position.sub(center); 

          // PERBAIKAN 2: Traverse untuk fix bayangan dan material depthWrite 
          model.traverse((child) => {
            if (child.isMesh) {
              child.castShadow = true;
              child.receiveShadow = true;
              if (child.material) {
                child.material.depthWrite = true;
              }
            }
          });

          scene.add(model);
        })
        .catch((error) => {
          console.error("Error loading model:", error);
        });

      // 6. Handle Resize
      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      // 7. Animasi
      function animate() {
        requestAnimationFrame(animate);
        
        // Sekarang 'model' sudah terisi, rotasi akan berjalan
        if (model) {
          model.rotation.y += 0.01; 
        }
        
        renderer.render(scene, camera);
      }
      animate();
    </script>
  </body>
</html>